---
title: 'SQL Recipe Directory'
description: "A curated set of BigQuery SQL snippets to answer common questions using SourceMedium tables"
icon: "code"
---

### Overview

Use these queries as starting points for analysis in BigQuery. Replace placeholders like `{{account_id}}` and filter for your brand/store as needed.

Notes:

- Prefer SourceMedium v2 tables when available (`sm_transformed_v2`), and start with `is_order_sm_valid = TRUE` for order-based analyses.
- If you’re not sure which table to use, start with: [`obt_orders`](/data-activation/data-tables/sm_transformed_v2/obt_orders) and [`obt_order_lines`](/data-activation/data-tables/sm_transformed_v2/obt_order_lines).

## Product Insights
<AccordionGroup>
    <Accordion title='Most commonly ordered product combinations'>
        ```sql
        WITH RECURSIVE product_combos AS (
            -- Anchor: Start with individual products per order
            SELECT
                ol.smcid,
                ol.sm_order_key,
                1 AS combo_length,
                CONCAT(ol.product_title, ' - ', ol.variant_title) AS combo,
                CONCAT(ol.product_title, ' - ', ol.variant_title) AS last_item
            FROM `sm-{{account_id}}.sm_transformed_v2.obt_order_lines` AS ol
            WHERE ol.smcid = 'your-smcid'
              AND ol.is_order_sm_valid = TRUE

            UNION ALL

            -- Recursive: Build combinations up to 5 products
            SELECT
                ol.smcid,
                ol.sm_order_key,
                pc.combo_length + 1,
                CONCAT(pc.combo, ', ', CONCAT(ol.product_title, ' - ', ol.variant_title)),
                CONCAT(ol.product_title, ' - ', ol.variant_title)
            FROM product_combos AS pc
            INNER JOIN `sm-{{account_id}}.sm_transformed_v2.obt_order_lines` AS ol
                ON ol.sm_order_key = pc.sm_order_key
                AND CONCAT(ol.product_title, ' - ', ol.variant_title) > pc.last_item
            WHERE pc.combo_length < 5
              AND ol.is_order_sm_valid = TRUE
        )

        SELECT
            combo AS product_combinations,
            COUNT(DISTINCT sm_order_key) AS order_frequency,
            combo_length AS num_products
        FROM product_combos
        WHERE combo_length >= 2
        GROUP BY combo, combo_length
        HAVING order_frequency >= 100
        ORDER BY order_frequency DESC, combo ASC
        LIMIT 100;
        ```

    </Accordion>
</AccordionGroup>

## More recipes

We regularly add new recipes. If there’s a query you’d like added (subscription churn, cohort LTV curves, creative performance, etc.), reach out to your SourceMedium team and include the business question and the table(s) you’re using.
